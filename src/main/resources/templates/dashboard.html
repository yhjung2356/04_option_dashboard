<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>선물/옵션 실시간 거래 대시보드</title>
    <link rel="stylesheet" th:href="@{/css/dashboard.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="dashboard-container">
        <!-- Header -->
        <header class="dashboard-header-compact">
            <div class="header-content-compact">
                <div class="header-left">
                    <h1><i class="fas fa-chart-line"></i> 선물/옵션 대시보드</h1>
                    <div id="market-closed-banner" class="inline-market-status" style="display: none;">
                        <i class="fas fa-moon"></i> 장 마감
                    </div>
                </div>
                <div class="header-right">
                    <button onclick="showInvestorNotice()" class="notice-btn-compact" title="투자자 안내문">
                        <i class="fas fa-exclamation-circle"></i>
                    </button>
                    <span id="current-time" class="time-display-compact"></span>
                    <span id="market-status" class="status-indicator-compact">
                        <i class="fas fa-circle status-live"></i> <span id="status-text">확인중</span>
                    </span>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <div class="dashboard-content">
            <!-- Top Section: Compact Overview -->
            <section class="overview-section-compact">
                <div class="card overview-card-compact">
                    <div class="card-header-compact">
                        <i class="fas fa-rocket"></i> 선물
                    </div>
                    <div class="card-body-compact">
                        <div class="stat-compact">
                            <span class="stat-label-mini">거래량</span>
                            <span class="stat-value-compact" id="futures-volume">0</span>
                        </div>
                        <div class="stat-compact">
                            <span class="stat-label-mini">거래대금</span>
                            <span class="stat-value-compact" id="futures-value">0</span>
                        </div>
                        <div class="stat-compact">
                            <span class="stat-label-mini">미결제</span>
                            <span class="stat-value-compact" id="futures-oi">0</span>
                        </div>
                    </div>
                </div>

                <div class="card overview-card-compact">
                    <div class="card-header-compact">
                        <i class="fas fa-layer-group"></i> 옵션
                    </div>
                    <div class="card-body-compact">
                        <div class="stat-compact">
                            <span class="stat-label-mini">거래량</span>
                            <span class="stat-value-compact" id="options-volume">0</span>
                        </div>
                        <div class="stat-compact">
                            <span class="stat-label-mini">거래대금</span>
                            <span class="stat-value-compact" id="options-value">0</span>
                        </div>
                        <div class="stat-compact">
                            <span class="stat-label-mini">미결제</span>
                            <span class="stat-value-compact" id="options-oi">0</span>
                        </div>
                    </div>
                </div>

                <div class="card overview-card-compact highlight-card-compact">
                    <div class="card-header-compact">
                        <i class="fas fa-balance-scale"></i> P/C Ratio
                    </div>
                    <div class="card-body-compact">
                        <div class="stat-compact">
                            <span class="stat-label-mini">거래량</span>
                            <span class="stat-value-compact ratio-value" id="pc-ratio-volume">0.00</span>
                        </div>
                        <div class="stat-compact">
                            <span class="stat-label-mini">미결제</span>
                            <span class="stat-value-compact ratio-value" id="pc-ratio-oi">0.00</span>
                        </div>
                        <div class="stat-compact">
                            <span class="stat-label-mini">거래대금</span>
                            <span class="stat-value-compact ratio-value" id="pc-ratio-value">0.00</span>
                        </div>
                    </div>
                </div>
                
                <div class="card overview-card-compact market-sentiment-card">
                    <div class="card-header-compact">
                        <i class="fas fa-brain"></i> 시장 심리
                    </div>
                    <div class="card-body-compact">
                        <div class="sentiment-gauge">
                            <div class="gauge-bar" id="sentiment-gauge">
                                <div class="gauge-fill" id="sentiment-fill"></div>
                            </div>
                            <div class="sentiment-label" id="sentiment-label">중립</div>
                        </div>
                        <div class="stat-compact">
                            <span class="stat-label-mini">IV 지수</span>
                            <span class="stat-value-compact" id="iv-index">--</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Greeks Summary Section -->
            <section class="greeks-section">
                <div class="card greeks-card">
                    <div class="card-header-compact">
                        <i class="fas fa-calculator"></i> Greeks 요약 (ATM 기준)
                    </div>
                    <div class="greeks-body">
                        <div class="greek-item">
                            <span class="greek-label">Delta</span>
                            <span class="greek-value" id="greek-delta">
                                <span class="greek-call" id="delta-call">--</span> / 
                                <span class="greek-put" id="delta-put">--</span>
                            </span>
                        </div>
                        <div class="greek-item">
                            <span class="greek-label">Gamma</span>
                            <span class="greek-value" id="greek-gamma">--</span>
                        </div>
                        <div class="greek-item">
                            <span class="greek-label">Theta</span>
                            <span class="greek-value" id="greek-theta">--</span>
                        </div>
                        <div class="greek-item">
                            <span class="greek-label">Vega</span>
                            <span class="greek-value" id="greek-vega">--</span>
                        </div>
                        <div class="greek-item">
                            <span class="greek-label">IV (내재변동성)</span>
                            <span class="greek-value" id="greek-iv">--</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Middle Section: Top Traded (Compact) -->
            <section class="top-traded-section-compact">
                <div class="card top-card-compact">
                    <div class="card-header-compact">
                        <i class="fas fa-chart-bar"></i> 거래량 TOP 5
                    </div>
                    <div class="card-body-compact">
                        <table class="data-table-compact">
                            <thead>
                                <tr>
                                    <th>순위</th>
                                    <th>종목코드</th>
                                    <th>종목명</th>
                                    <th>현재가</th>
                                    <th>거래량</th>
                                    <th>거래대금</th>
                                    <th>미결제</th>
                                </tr>
                            </thead>
                            <tbody id="top-by-volume">
                                <tr style="display: none;"><td colspan="7" class="loading">데이터 로딩 중...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="card top-card-compact">
                    <div class="card-header-compact">
                        <i class="fas fa-layer-group"></i> 미결제약정 TOP 5
                    </div>
                    <div class="card-body-compact">
                        <table class="data-table-compact">
                            <thead>
                                <tr>
                                    <th>순위</th>
                                    <th>종목코드</th>
                                    <th>종목명</th>
                                    <th>현재가</th>
                                    <th>거래량</th>
                                    <th>거래대금</th>
                                    <th>미결제</th>
                                </tr>
                            </thead>
                            <tbody id="top-by-oi">
                                <tr style="display: none;"><td colspan="7" class="loading">데이터 로딩 중...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Bottom Section: Option Chain Analysis (Compact) -->
            <section class="option-chain-section-compact">
                <div class="card option-chain-card-compact">
                    <div class="card-header-compact" style="justify-content: space-between;">
                        <div class="option-header-left">
                            <i class="fas fa-table"></i> 옵션 체인 분석
                        </div>
                        <div class="option-chain-info-compact">
                            <span class="info-item-compact">기초: <strong id="underlying-price">0</strong></span>
                            <span class="info-item-compact">ATM: <strong id="atm-strike">0</strong></span>
                            <span class="info-item-compact max-pain-compact">
                                <i class="fas fa-bullseye"></i> <strong id="max-pain">0</strong>
                            </span>
                        </div>
                    </div>
                    <div class="card-body-compact">
                        <div class="option-chain-table-wrapper">
                            <table class="option-chain-table-compact">
                                <thead>
                                    <tr>
                                        <th colspan="5" class="call-header">CALL</th>
                                        <th class="strike-header">행사가</th>
                                        <th colspan="5" class="put-header">PUT</th>
                                    </tr>
                                    <tr>
                                        <th>호가</th>
                                        <th>델타</th>
                                        <th>거래량</th>
                                        <th>미결제</th>
                                        <th>현재가</th>
                                        <th>Strike</th>
                                        <th>현재가</th>
                                        <th>미결제</th>
                                        <th>거래량</th>
                                        <th>델타</th>
                                        <th>호가</th>
                                    </tr>
                                </thead>
                                <tbody id="option-chain-body">
                                    <tr style="display: none;"><td colspan="11" class="loading">데이터 로딩 중...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>
                                        <th colspan="5" class="put-header">PUT</th>
                                    </tr>
                                    <tr>
                                        <th>호가</th>
                                        <th>델타</th>
                                        <th>거래량</th>
                                        <th>미결제</th>
                                        <th>현재가</th>
                                        <th>Strike</th>
                                        <th>현재가</th>
                                        <th>미결제</th>
                                        <th>거래량</th>
                                        <th>델타</th>
                                        <th>호가</th>
                                    </tr>
                                </thead>
                                <tbody id="option-chain-body">
                                    <tr><td colspan="11" class="loading">데이터 로딩 중...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- 투자자 안내문 모달 -->
    <div id="investorNoticeModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close-modal" onclick="closeInvestorNotice()">&times;</span>
            <h2><i class="fas fa-exclamation-triangle"></i> 투자자 안내문</h2>
            <div class="modal-body">
                <h3>⚠️ 투자 위험 고지</h3>
                <p>본 대시보드는 선물 및 옵션 거래 정보를 제공하는 도구로, <strong>투자 권유나 매매 추천을 목적으로 하지 않습니다.</strong></p>
                
                <h3>📋 주요 유의사항</h3>
                <ul>
                    <li><strong>고위험 상품:</strong> 선물과 옵션은 고위험 금융상품으로 원금 손실 위험이 매우 큽니다.</li>
                    <li><strong>레버리지 위험:</strong> 적은 증거금으로 큰 금액을 거래하므로 손실이 증폭될 수 있습니다.</li>
                    <li><strong>데이터 정확성:</strong> 제공되는 데이터는 참고용이며, 실시간 시세와 차이가 있을 수 있습니다.</li>
                    <li><strong>투자 책임:</strong> 모든 투자 결정과 그에 따른 손익은 전적으로 투자자 본인의 책임입니다.</li>
                </ul>

                <h3>💡 권장사항</h3>
                <ul>
                    <li>충분한 학습과 이해 후 투자하시기 바랍니다.</li>
                    <li>투자 전 금융상품 설명서를 반드시 확인하세요.</li>
                    <li>여유 자금으로만 투자하시고, 무리한 레버리지는 지양하세요.</li>
                    <li>전문가의 조언이 필요한 경우 금융 전문가와 상담하세요.</li>
                </ul>

                <div class="notice-footer">
                    <p><strong>본 서비스를 이용함으로써 위 내용을 충분히 이해하고 동의한 것으로 간주됩니다.</strong></p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.5.2/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
    
    <!-- 페이지 초기 상태 전달 (서버에서 JavaScript로) -->
    <script th:inline="javascript">
        // 서버에서 전달된 초기 상태
        const PAGE_STATE = {
            dataSource: /*[[${dataSource}]]*/ 'KIS',
            demoMode: /*[[${demoMode}]]*/ false,
            marketHoursEnabled: /*[[${marketHoursEnabled}]]*/ true,
            initialTimestamp: /*[[${currentTimestamp}]]*/ 0
        };
        
        // 전역 상태 객체
        window.dashboardState = {
            ...PAGE_STATE,
            isConnected: false,
            lastUpdate: null,
            currentView: 'overview' // 현재 보고 있는 뷰
        };
        
        console.log('초기 페이지 상태:', window.dashboardState);
    </script>
    
    <script th:src="@{/js/dashboard.js}"></script>
</body>
</html>
