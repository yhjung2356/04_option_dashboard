# TODO List - KOSPI200 Options Dashboard

## ✅ 최근 완료 (2025-12-26)

### 실시간 업데이트 완전 수정 🎉
- [x] **WebSocket 데이터 파싱 개선**
  - Pipe-delimited 파서 구현 (`0|TR_ID|001|SYMBOL^FIELD1^FIELD2^...`)
  - `handleFuturesPipeData()`, `handleOptionPipeData()` 메서드 추가
  - 필드명 대소문자 오류 수정 (ACML_VOL → acml_vol)
  
- [x] **야간장 거래 지원**
  - 선물 야간장 TR_ID: H0MFCNT0
  - 옵션 야간장 TR_ID: H0EUCNT0
  - 시간대별 TR_ID 자동 선택 (18:00~09:00 → 야간장, 09:00~18:00 → 정규장)
  
- [x] **데이터베이스 무결성 개선**
  - `FuturesData.symbol`, `OptionData.symbol`에 UNIQUE 제약조건 추가
  - NonUniqueResultException 오류 완전 해결
  - 중복 레코드 방지로 안정성 향상
  
- [x] **로그 정리**
  - 백엔드: DEBUG → INFO 레벨 변경 (application.properties)
  - 프론트엔드: 모든 console.log 주석 처리 (에러만 유지)
  - 개발 시 필요한 로그는 주석 해제하여 사용 가능
  
- [x] **사이드바 UI 최적화**
  - 거래량 추이 차트 컴포넌트 제거 (VolumeChart.vue)
  - Greeks 카드 디자인 개선: 컬러풀한 gradient 배경 (파랑/보라/주황/초록/핑크)
  - 시장 심리 게이지 크기 확대 및 indigo 색상 적용
  - 카드 패딩 증가 (p-2 → p-3), 텍스트 크기 확대
  
- [x] **API 경로 통일**
  - 프론트엔드 API 경로를 백엔드 컨트롤러와 일치
  - `/api/market-overview` → `/api/market/overview`
  - `/api/option-chain` → `/api/market/option-chain`
  - 404 Not Found 오류 완전 해결
  
- [x] **설정 페이지 정확도 개선**
  - `MarketOverviewDTO`에 `dataSource` 필드 추가
  - 백엔드에서 `application.properties`의 `trading.data-source` 값 주입
  - 프론트엔드에서 "실시간 KIS API" 정확하게 표시 (이전: "데모 데이터")
  - TypeScript 타입 정의 수정: `'LIVE'|'DEMO'` → `'KIS'|'MOCK'`

### 시스템 검증 결과 ✅
- WebSocket 연결: ✅ 성공 (wss://ops.koreainvestment.com:21000)
- 구독 현황: ✅ 1개 선물 + 39개 옵션 = 총 40개 심볼
- 실시간 업데이트: ✅ 거래량, 가격 정상 업데이트 확인
- 데이터베이스: ✅ 중복 레코드 없음, UNIQUE 제약조건 정상 작동
- 프론트엔드 빌드: ✅ 번들 사이즈 최적화 (chart.js 제거)
- 콘솔 로그: ✅ 에러만 표시, 불필요한 디버그 로그 제거

---

## 🔴 우선순위 높음 (즉시 처리)

### 안정성 & 버그 수정
- [ ] Greeks 값 검증 (Delta, Gamma, Theta, Vega가 모두 0.000으로 표시됨)
  - KIS API에서 Greeks 데이터를 제대로 반환하는지 확인
  - API 응답 필드명 확인 (gama, theta, vega, delta_val)

---

## 🟡 단기 개선 (1~2주 내)

### 기능 추가
- [ ] **실시간 가격 차트 추가** 🎯
  - [ ] 선물 1분/5분 캔들 차트 (TradingView Lightweight Charts)
  - [ ] ATM 옵션 가격 추이 차트
  - [ ] 거래량 히스토그램
  - [ ] 차트 확대/축소 기능
  
- [ ] **호가창 (Order Book) 기능** 💰
  - [ ] 선물 10호가 실시간 표시
  - [ ] 매수/매도 잔량 막대 그래프
  - [ ] 호가 스프레드 계산
  - [ ] 체결 강도 표시
  
- [ ] **알림 기능** 🔔
  - [ ] 가격 알림 (특정 가격 도달 시 브라우저 알림)
  - [ ] 거래량 급증 알림 (전 분 대비 2배 이상)
  - [ ] IV 급변 알림 (±10% 이상 변동)
  - [ ] 알림 설정 UI (설정 페이지에 추가)

- [ ] **마켓 뎁스 (호가창 Depth) 시각화** 🎯
  - [ ] 선물 호가창 depth 막대 그래프
    - 매수/매도 호가별 잔량을 막대 길이로 표시
    - 실시간 호가 변동 애니메이션
    - 누적 잔량 표시
  - [ ] 옵션 행사가별 호가 depth
    - Call/Put 각각의 매수/매도 벽 시각화
    - 스프레드 크기 색상 표시
  - [ ] 대량 주문 감지 및 알림
    - 특정 가격대 호가 급증 알림
    - 매수/매도벽 형성 알림
  - [ ] UI 디자인: 업비트 스타일 호가창
    - 중앙에 현재가, 좌우로 매수/매도
    - 호가 잔량 비율에 따른 배경색
    
- [ ] **차트 기능**
  - [ ] 실시간 가격 차트 (TradingView 또는 Chart.js)
  - [ ] IV Skew 차트 (행사가별 IV 분포)
  - [ ] Greeks 시간별 변화 추이
  - [ ] Put/Call Ratio 추이 그래프
  
- [ ] **알림 기능**
  - [ ] 가격 알림 (특정 가격 도달 시)
  - [ ] IV 급변 알림 (임계값 설정)
  - [ ] 거래량 급증 알림
  - [ ] Max Pain 변동 알림

- [ ] **포지션 관리**
  - [ ] 가상 포트폴리오 (로컬 저장)
  - [ ] 손익 계산기
  - [ ] Greeks 포트폴리오 합산

### UI/UX 개선
- [ ] **데이터 테이블 필터링** 📊
  - [ ] 옵션 체인 필터: ITM/ATM/OTM만 보기
  - [ ] 거래량 임계값 필터 (0 이상만 표시)
  - [ ] IV 범위 필터
  - [ ] 정렬 기능 강화 (Greeks 기준 정렬)
  
- [ ] **키보드 단축키** ⌨️
  - [ ] ↑↓ 키로 행사가 이동
  - [ ] F5로 데이터 새로고침
  - [ ] Ctrl+D로 다크모드 토글
  - [ ] Esc로 모달/사이드바 닫기
  
- [ ] 모바일 반응형 개선
  - [ ] 옵션 체인 테이블 스크롤 최적화
  - [ ] 사이드바 접기/펼치기 애니메이션
- [ ] 키보드 단축키
  - [ ] 행사가 이동 (↑↓)
  - [ ] 새로고침 (F5)
  - [ ] 다크모드 토글 (Ctrl+D)

---

## 🟢 중기 개선 (1~2개월)

### 성능 최적화
- [ ] **데이터 캐싱**
  - [ ] Redis 캐시 도입 (현재 H2 in-memory)
  - [ ] 웹소켓 메시지 압축
  - [ ] API 응답 캐싱 전략
  
- [ ] **로딩 성능**
  - [ ] 초기 로딩 최적화 (현재 4.8초 → 목표 2초)
  - [ ] 옵션 체인 가상 스크롤링
  - [ ] 이미지/아이콘 lazy loading

### 데이터 분석
- [ ] **옵션 전략 분석**

### 안정성 강화
- [ ] 웹소켓 연결 안정성 개선
  - [ ] 장 시작/종료 시 자동 재연결
  - [ ] 연결 끊김 시 사용자 알림
  - [ ] 재연결 로직 개선
- [ ] API Rate Limit 모니터링
  - [ ] KIS API 제약 확인 및 최적화
  - [ ] 요청 속도 조절 (현재 100ms 간격)
  - [ ] Bull Call Spread 수익률 계산
  - [ ] Iron Condor 손익분기점
  - [ ] Straddle/Strangle 손익 시뮬레이션
  
- [ ] **통계 분석**
  - [ ] 과거 IV vs 현재 IV 비교
  - [ ] 평균 회귀 분석
  - [ ] 거래량 패턴 분석

### 백테스팅
- [ ] 과거 데이터 저장 (CSV/Database)
- [ ] 전략 백테스트 엔진
- [ ] 수익률 시뮬레이션

---

## 🔵 장기 개선 (3개월 이상)

### 새로운 시장 데이터
- [ ] **추가 파생상품**
  - [ ] 개별주식 옵션 (삼성전자, SK하이닉스 등)
  - [ ] 달러선물/옵션
  - [ ] 금선물/옵션

- [ ] **암호화폐 시장 참고**
  - [ ] 업비트 스타일 UI/UX 벤치마킹
  - [ ] 실시간 데이터 처리 기법 연구

### 고급 기능
- [ ] **AI/ML 기능**
  - [ ] IV 예측 모델
  - [ ] 가격 방향성 예측
  - [ ] 이상 거래 감지
  
- [ ] **소셜 기능**
  - [ ] 사용자 전략 공유
  - [ ] 커뮤니티 투표 (강세/약세)
  - [ ] 실시간 채팅

### 인프라
- [ ] **배포 자동화**
  - [ ] Docker 컨테이너화
  - [ ] CI/CD 파이프라인 (GitHub Actions)
  - [ ] AWS/클라우드 배포
  
- [ ] **모니터링**
  - [ ] Prometheus + Grafana
  - [ ] 에러 추적 (Sentry)
  - [ ] 성능 모니터링 (APM)

---

## 💡 아이디어 / 고려사항

### 마켓 뎁스 (호가창 Depth) 구현 계획
```
목표: 업비트 스타일 호가창 depth 시각화를 선물/옵션에 적용

UI 레이아웃:
┌─────────────────────────────────────┐
│   매도 호가    │ 가격  │  매수 호가   │
├─────────────────────────────────────┤
│ ████████ 120   │ 591.5 │             │ ← 매도 1호가
│ ██████ 85      │ 591.0 │             │ ← 매도 2호가
│ ████ 50        │ 590.5 │             │ ← 매도 3호가
├─────────────────────────────────────┤
│           590.35 (현재가) ▼ -0.15    │ ← 실시간 가격
├─────────────────────────────────────┤
│                │ 590.0 │ ████ 65     │ ← 매수 1호가
│                │ 589.5 │ ██████ 90   │ ← 매수 2호가
│                │ 589.0 │ ████████ 125│ ← 매수 3호가
└─────────────────────────────────────┘

기능 상세:
1. 실시간 호가 잔량 변화
   - 막대 길이: 잔량에 비례
   - 색상: 매도(빨강), 매수(초록)
   - 애니메이션: 잔량 변화 시 부드럽게 전환

2. 누적 호가 표시
   - 각 가격대별 누적 잔량
   - 매수/매도벽 시각적으로 표시

3. 호가 스프레드 정보
   - 1호가 스프레드 실시간 계산
   - 스프레드 넓으면 주의 표시

4. 대량 호가 알림
   - 특정 임계값 이상 호가 등장 시 알림
   - 호가 급변 감지

KIS API 호가 데이터:
- 선물: /uapi/domestic-futureoption/v1/quotations/inquire-asking-price-exp-ccn
- 옵션: /uapi/domestic-futureoption/v1/quotations/inquire-asking-price-exp-ccn
- 실시간: WebSocket H0STCNI0, H0STCNI9

구현 우선순위:
1단계: 선물 호가창 (가장 단순)
2단계: 옵션 호가창 (행사가별로 확장)
3단계: 애니메이션 및 알림
```

### 데이터 시각화
- [ ] Heatmap (행사가 × 만기 × IV)
- [ ] 3D Greeks 표면
- [ ] 실시간 거래 히트맵 (Flash Order)

### 사용자 경험
- [ ] 튜토리얼 모드 (초보자용)
- [ ] 프리셋 저장 (레이아웃, 필터)
- [ ] 멀티 워크스페이스

### 리팩토링
- [ ] 백엔드 서비스 레이어 분리
- [ ] 프론트엔드 컴포넌트 재사용성 개선
- [ ] 테스트 커버리지 향상 (현재 0% → 목표 80%)
 (1초마다 브로드캐스트)
- [x] 프론트엔드 빌드 최적화
- [x] Max Pain 계산 로직 검증 (정상 작동)
- [x] 다크모드 구현 및 토글 기능

## 📝 완료된 작업

### 2025-12-26 (Day 4)
- [x] **실시간 거래량 업데이트 완전 수정** ✅
  - [x] Pipe-delimited 데이터 파서 구현 (`0|TR_ID|001|DATA^...` 형식)
  - [x] 야간장 TR_ID 지원 (H0MFCNT0, H0EUCNT0)
  - [x] 필드명 오류 수정 (ACML_VOL → acml_vol, 소문자)
  - [x] DB UNIQUE 제약조건 추가 (중복 레코드 방지)
  - [x] 선물/옵션 실시간 업데이트 검증 완료
  
- [x] **로그 정리 및 최적화** 🧹
  - [x] 백엔드 DEBUG → INFO 레벨 변경
  - [x] 프론트엔드 console.log 대부분 주석 처리
  - [x] 에러 로그만 유지 (개발 시 필요하면 주석 해제)
  
- [x] **UI/UX 개선** 🎨
  - [x] 사이드바 거래량 추이 차트 제거 (불필요)
  - [x] Greeks 카드 디자인 대폭 개선
    - 각 Greek마다 컬러풀한 gradient 배경
    - 텍스트 크기 확대 (가독성 향상)
    - IV 카드 강조 표시
  - [x] 시장 심리 게이지 크기 확대 및 색상 변경 (indigo)
  - [x] 사이드바 전체 레이아웃 정리
  
- [x] **API 경로 수정** 🔧
  - [x] 프론트엔드 API 경로 통일
    - `/api/market-overview` → `/api/market/overview`
    - `/api/option-chain` → `/api/market/option-chain`
  - [x] 404 에러 완전 해결
  
- [x] **설정 페이지 정보 정확도 개선** ⚙️
  - [x] MarketOverviewDTO에 dataSource 필드 추가
  - [x] "데모 데이터" → "실시간 KIS API" 정확한 표시
  - [x] TypeScript 타입 정의 수정 ('LIVE'|'DEMO' → 'KIS'|'MOCK')

### 2025-12-25 (Day 3)
- [x] 야간장/주간장 시장 구분 (CM/EU, F/O)
- [x] IV 스케일링 오류 수정 (0.21 → 21%)
- [x] 거래량 표시 형식 (K/M → 쉼표)
- [x] 옵션 체인 웹소켓 실시간 업데이트
- [x] 프론트엔드 빌드 최적화

---

## 📚 참고 자료

### API 문서
- [한국투자증권 KIS API](https://apiportal.koreainvestment.com/)
- [업비트 WebSocket API](https://docs.upbit.com/reference/websocket)

### 옵션 이론
- Black-Scholes 모델
- Greeks 계산 공식
- IV Skew 해석

### 유사 프로젝트
- TradingView
- Think or Swim
- Interactive Brokers TWS

---

**마지막 업데이트**: 2025-12-26
**버전**: 2.0.0
