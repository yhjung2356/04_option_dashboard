# 📋 선물/옵션 대시보드 - 할 일 목록

> **작성일:** 2025-12-24  
> **마지막 업데이트:** 2025-12-25 (수요일)  
> **다음 리뷰:** 2025-12-27 (금요일)

---

## 🎯 금요일(12/27) 우선 작업

### 1. ⚡ 실시간 성능 테스트 및 모니터링 ⭐
- [ ] **부하 테스트** (장 개장 시 필수)
  - 실제 장중 WebSocket 연결 안정성 확인
  - 메모리 사용량 모니터링 (JVM Heap)
  - CPU 사용률 체크
  - 로그 파일에서 에러/경고 확인 (`logs/` 폴더)

- [x] **데이터 정합성 검증** ✅
  - ~~선물 거래대금이 올바르게 표시되는지 확인 (억원 단위)~~ → 12/25 검증 완료
  - ~~옵션 실시간 구독이 주간장에서 꺼져있는지 확인~~ → 12/23 완료
  - ~~Put/Call Ratio 계산 정확도 검증~~ → 12/25 검증 완료
  - ~~Greeks 값 (Delta, Gamma, Theta, Vega) 합리성 체크~~ → 0값 필터링 완료

- [ ] **휴장일 모니터링 추가 검증**
  - 12/27(금) 정상 거래일에 실시간 데이터 로드 확인
  - 휴장일/거래일 자동 전환 테스트
  - 웹소켓 연결/해제 로직 검증

### 2. 🔍 UI/UX 개선
- [ ] **대시보드 반응형 개선**
  - 모바일/태블릿에서 레이아웃 확인
  - 차트 크기 조정 (화면에 맞게)
  - 버튼 크기 및 간격 최적화

- [ ] **사용자 피드백 반영**
  - 색상 가독성 개선 (콜옵션 파란색, 풋옵션 빨간색 등)
  - 숫자 포맷팅 일관성 (천단위 쉼표, 소수점 자리수)
  - 로딩 인디케이터 추가 (데이터 갱신 시)

### 3. 📊 옵션 체인 기능 강화
- [ ] **Greeks 실시간 업데이트**
  - 현재는 초기 로딩만 있음
  - WebSocket으로 실시간 Greeks 계산/표시
  - IV(내재변동성) 실시간 반영

- [x] **Max Pain 계산** ✅
  - ~~현재 알고리즘 정확도 검증~~ → 12/25 검증 (580.00)
  - 미결제약정 기반 Max Pain 차트 추가 고려

---

## 🚀 향후 개선 사항 (우선순위 순)

### 우선순위 A (핵심 기능)

#### 1. 토큰 관리 통합 ⭐⭐⭐
- **현재 문제**: `KisApiService`와 `SymbolMasterService`에 각각 토큰 관리 로직 존재
- **해결 방안**:
  - 공통 `TokenService` 또는 `TokenManager` 클래스 생성
  - Singleton 패턴으로 전역 토큰 관리
  - 토큰 만료 30초 전 자동 갱신
- **예상 작업 시간**: 2-3시간
- **파일 위치**: `src/main/java/com/trading/dashboard/service/TokenService.java` (신규)

#### 2. Rate Limiting 처리 ⭐⭐⭐
- **현재 문제**: KIS API 호출 시 Rate Limit 에러 발생 가능
- **해결 방안**:
  - Resilience4j 또는 Spring Retry 사용
  - Exponential Backoff 전략 (1초 → 2초 → 4초)
  - 최대 재시도 횟수 설정 (3회)
  - 429 에러 시 자동 대기 후 재시도
- **예상 작업 시간**: 3-4시간
- **파일 위치**: 
  - `pom.xml` (Resilience4j 의존성 추가)
  - `KisApiService.java` (retry 로직 추가)

#### 3. 야간장 대응 ⭐⭐
- **현재 상태**: 주간장(09:00-15:30)만 지원
- **야간장 시간**: 16:00-익일 05:00
- **필요 작업**:
  - 야간장 TR_ID 매핑 추가
  - 시간대별 종목코드 분기 처리
  - 야간장 전용 WebSocket 연결 로직
  - UI에 "야간장" 표시 추가
- **예상 작업 시간**: 5-6시간
- **참고**: `capture/data/` 폴더의 API 가이드 확인

### 우선순위 B (데이터 고도화)

#### 4. 백테스팅 기능 추가
- **목적**: 과거 데이터 기반 전략 검증
- **필요 작업**:
  - 과거 거래 데이터 DB 저장 (Daily)
  - 백테스팅 엔진 구현
  - 전략 성과 시각화 (차트)
- **예상 작업 시간**: 10-15시간
- **신규 테이블**: `historical_futures_data`, `historical_option_data`

#### 5. 알림 기능 (Alert)
- **기능**:
  - Put/Call Ratio 특정 값 이상 시 알림
  - 특정 종목 거래량 급증 시 알림
  - Max Pain 가격 변화 시 알림
- **알림 채널**:
  - 브라우저 푸시 알림 (Web Notification API)
  - 이메일 (선택 사항)
  - 텔레그램 봇 (선택 사항)
- **예상 작업 시간**: 6-8시간

#### 6. 멀티 계좌 지원
- **현재**: 단일 계좌만 지원
- **개선**: 여러 계좌 동시 모니터링
- **필요 작업**:
  - 계좌 설정 UI 추가
  - DB에 계좌별 데이터 분리 저장
  - 계좌 전환 드롭다운 메뉴
- **예상 작업 시간**: 8-10시간

### 우선순위 C (편의성)

#### 7. 테마 설정 (다크 모드)
- **기능**: 라이트/다크 테마 전환
- **저장**: LocalStorage에 사용자 선호도 저장
- **예상 작업 시간**: 2-3시간
- **파일**: `dashboard.css` 수정, `dashboard.js` 테마 토글 추가

#### 8. 데이터 내보내기 (Export)
- **형식**: CSV, Excel, JSON
- **대상 데이터**:
  - 옵션 체인 데이터
  - 상위 종목 리스트
  - 일별 거래 요약
- **예상 작업 시간**: 3-4시간

#### 9. 커스텀 대시보드
- **기능**: 사용자가 원하는 위젯만 표시
- **설정**: Drag & Drop으로 위젯 배치
- **저장**: 사용자별 레이아웃 DB 저장
- **예상 작업 시간**: 15-20시간 (대규모)

---

## 🐛 버그 및 개선 아이디어

### 알려진 이슈
- [x] ~~주간장 옵션 실시간 구독 비활성화 (KIS API 제약)~~ → 12/23 완료
  - ~~**해결 방법**: REST API 폴링으로 대체 고려~~
  - ~~**또는**: 야간장에서만 실시간 구독 활성화~~

- [ ] 캐시 갱신 타이밍 최적화 필요
  - **현재**: 매일 오전 8시, KOSPI200은 1분마다
  - **개선**: 장 시작 시간에 맞춰 동적 조정

- [ ] **휴장일 자동 업데이트 시스템**
  - **현재**: TradingCalendarService에 하드코딩 (2025-2026만)
  - **개선**: 공공데이터 API 또는 외부 캘린더 연동
  - **대안**: 매년 초 수동 업데이트 스크립트 작성

### 성능 최적화
- [ ] **DB 인덱스 추가**
  - `FuturesData`, `OptionData` 테이블의 `symbol`, `timestamp` 컬럼
  - 집계 쿼리 속도 개선 (현재 Full Scan)

- [ ] **WebSocket 재연결 로직 강화**
  - 현재: 단순 재연결
  - 개선: 지수 백오프 + 최대 재시도 제한

- [ ] **프론트엔드 번들링**
  - 현재: 개별 JS/CSS 파일
  - 개선: Webpack/Vite로 번들링 + 압축

---

## 📚 학습 및 연구

### 금융공학 심화
- [ ] Black-Scholes 모델 정확도 개선
  - 현재 Greeks 계산 검증
  - 실제 시장 데이터와 비교 분석

- [ ] Volatility Smile 시각화
  - 행사가별 IV 곡선 그리기
  - 시간대별 변화 추적

### 기술 스택 업그레이드
- [ ] **Spring Boot 3.x 업그레이드**
  - 현재: Spring Boot 2.7.x (추정)
  - 목표: Spring Boot 3.3.x + Java 21

- [ ] **React 프론트엔드 분리**
  - 현재: Thymeleaf + jQuery
  - 목표: React + TypeScript SPA

---

## 🔒 보안 강화

### 필수 보안 조치
- [ ] **API 키 관리 개선**
  - 현재: application.properties에 평문 저장
  - 개선: AWS Secrets Manager 또는 환경 변수

- [ ] **HTTPS 적용**
  - Let's Encrypt SSL 인증서
  - 자동 갱신 설정

- [ ] **입력 값 검증**
  - XSS 방지 (Cross-Site Scripting)
  - SQL Injection 방지 (Prepared Statement 사용 중)

---

## 📁 프로젝트 정리

### 문서화
- [ ] API 문서 자동 생성 (Swagger/OpenAPI)
- [ ] 아키텍처 다이어그램 작성 (Draw.io)
- [ ] 배포 가이드 업데이트 (Docker Compose 추가)

### 코드 리팩토링
- [ ] 테스트 코드 작성 (JUnit 5)
  - 현재 테스트 커버리지: ~0%
  - 목표: 최소 50% 이상
- [ ] SonarQube 정적 분석
- [ ] 주석 및 JavaDoc 추가

---

## � 새로운 기능 아이디어 (2025-12-25 추가)

### 우선순위 S (Super - 핵심 시각화)

#### 1. 마켓 뎁스 (Market Depth) 차트 ⭐⭐⭐
- **영감**: 업비트 호가창 시각화
- **기능**:
  - 실시간 호가 데이터 표시 (매수/매도 벽)
  - Depth Chart (깊이 차트): 가격별 주문량 누적 그래프
  - 체결 히트맵 (시간대별 체결 강도)
  - 호가 불균형 지표 (Buy/Sell Imbalance)
- **적용 대상**: 선물 + 주요 옵션 (ATM ±3)
- **기술 스택**: Chart.js 또는 D3.js
- **예상 작업 시간**: 10-15시간
- **신규 API 필요**: 호가 조회 API (현재 미구현)

#### 2. 옵션 히트맵 (Strike × Expiry) ⭐⭐⭐
- **기능**:
  - 행사가(X축) × 만기일(Y축) 2D 히트맵
  - 색상: 거래량, 미결제약정, IV, 또는 수익률
  - 마우스 오버 시 상세 정보 툴팁
  - ATM/ITM/OTM 구간 구분선
- **장점**: 한 눈에 시장 전체 파악
- **예상 작업 시간**: 8-10시간
- **파일 위치**: 새 페이지 `heatmap.html` 또는 대시보드 섹션 추가

#### 3. Volatility Surface 3D 시각화 ⭐⭐
- **기능**:
  - Strike Price × Expiry Date × IV를 3D로 표시
  - 회전/확대 가능한 인터랙티브 3D 그래프
  - Volatility Smile/Skew 패턴 분석
- **기술 스택**: Plotly.js 또는 Three.js
- **예상 작업 시간**: 15-20시간
- **난이도**: 높음 (3D 렌더링 + 수학 계산)

### 우선순위 A+ (고급 분석)

#### 4. 옵션 전략 시뮬레이터 ⭐⭐⭐
- **전략 종류**:
  - Long/Short Call/Put (기본)
  - Straddle, Strangle (변동성 플레이)
  - Bull/Bear Spread (방향성 플레이)
  - Iron Condor, Butterfly (중립 전략)
- **기능**:
  - 손익 그래프 (P&L Diagram)
  - 최대 손실/이익, 손익분기점 계산
  - Greeks 합성 (Portfolio Greeks)
  - "만약에" 시나리오 (What-If Analysis)
- **예상 작업 시간**: 20-25시간
- **신규 페이지**: `strategy-simulator.html`

#### 5. 포지션 트래커 (내 계좌 분석) ⭐⭐
- **기능**:
  - 보유 선물/옵션 포지션 목록
  - 실시간 평가손익 (P&L)
  - 포트폴리오 Greeks (Delta, Gamma, Theta, Vega 합계)
  - 위험도 분석 (VaR, Expected Shortfall)
- **예상 작업 시간**: 12-15시간
- **신규 테이블**: `user_positions`

#### 6. IV Rank & IV Percentile 추적 ⭐⭐
- **IV Rank**: 현재 IV가 과거 52주 범위에서 몇 %인지
- **IV Percentile**: 과거 252일 중 현재 IV보다 낮은 날의 비율
- **차트**: 시계열 IV 변화 + 히스토그램
- **예상 작업 시간**: 6-8시간

### 우선순위 B+ (편의 기능)

#### 7. 실시간 뉴스 피드 ⭐
- **소스**: 네이버 금융, 증권사 공시, 또는 RSS
- **필터링**: KOSPI200 관련 뉴스만
- **예상 작업 시간**: 5-7시간
- **API**: 뉴스 크롤링 또는 공개 API

#### 8. 경제 지표 캘린더 ⭐
- **표시 항목**: 한국은행 금리 결정, FOMC, 고용지표 등
- **알림**: 중요 지표 발표 1시간 전 알림
- **예상 작업 시간**: 4-6시간
- **데이터 소스**: Investing.com API 또는 한국은행 공개 API

#### 9. 시간대별 거래량 분포 차트
- **기능**: 09:00-15:30 시간대별 거래량 막대 차트
- **분석**: 장 시작/마감 시 거래 집중도 확인
- **예상 작업 시간**: 3-4시간

#### 10. 스크리너 (Screener) 기능
- **필터 조건**:
  - 거래량 > N
  - 미결제약정 > M
  - IV > X%
  - Delta 범위 지정
- **결과**: 조건 만족하는 옵션 목록 + 정렬
- **예상 작업 시간**: 8-10시간
- **신규 페이지**: `screener.html`

### 기술 부채 및 개선

#### 11. 사이드바 뷰 전환 버그 수정 🐛
- **현재 문제**: 
  - 다른 메뉴 클릭 후 대시보드 복귀 시 컨텐츠가 이상하게 표시됨
  - `showOverviewView` 함수의 동적 컨텐츠 제거 로직 개선 필요
- **해결 방안**:
  - 각 뷰의 상태를 명확하게 관리
  - 뷰 전환 시 이전 뷰 완전 초기화
  - 또는 SPA 프레임워크 도입 (React/Vue)
- **우선순위**: 높음 (사용성 이슈)
- **예상 작업 시간**: 2-3시간
- **파일**: `dashboard.js` lines 1053-1140

## �📝 메모

### 참고 사항
- **KIS API 제약**:
  - 초당 20건 호출 제한 (Rate Limit)
  - 토큰 유효 시간: 24시간
  - 주간장 옵션 실시간 TR_ID 없음

- **운영 서버 관리**:
  - 로그 파일 주기적 삭제 (`logs/` 폴더)
  - DB 백업 스케줄 설정 (일 1회)
  - 디스크 용량 모니터링

### 유용한 명령어
```bash
# 로그 실시간 확인
tail -f logs/spring.log

# 프로세스 확인
ps aux | grep java

# 메모리 사용량
free -h

# 디스크 용량
df -h

# Git 상태 확인
git status
git log --oneline -10
```

---

## ✅ 완료된 작업 (최근 업데이트)

### 2025-12-25 ⭐ (크리스마스 특집 업데이트!)
- [x] **휴장일 처리 시스템 구축**
  - TradingCalendarService 구현 (2025-2026 공휴일 34개)
  - 휴장일 감지 시 UI에 "휴장" 표시
  - WebSocket 자동 비활성화 (불필요한 API 호출 방지)

- [x] **전거래일 데이터 로드 기능**
  - KIS API 선물옵션기간별시세(FHKIF03020100) 통합
  - 휴장일에 자동으로 전거래일(20251224) 데이터 로드
  - InitialDataLoader에 holiday-aware 로직 추가

- [x] **KOSPI200 지수 정확도 개선**
  - 기초자산으로 선물가(584.80) 대신 실제 KOSPI200 지수(584.21) 사용
  - output1.kospi200_nmix 필드에서 직접 추출
  - FuturesData/OptionData에 underlyingPrice 필드 추가

- [x] **미결제약정 데이터 추가**
  - 선물 미결제약정: 208,407 (output1.hts_otst_stpl_qty)
  - 옵션 미결제약정: 74,892 (output1.hts_otst_stpl_qty)
  - 미결제약정 TOP 5 랭킹 표시

- [x] **옵션 체인 UI 개선**
  - ATM 표시 범위 축소 (±10 → ±5)
  - 행사가 내림차순 정렬
  - Greeks 0값 필터링 (불필요한 데이터 제거)
  - 행사가 파싱 로직 수정 (325.0 → 325 정상 표시)

- [x] **역사적 데이터 API 완전 통합**
  - 종가(futs_prpr), 거래량(acml_vol), 거래대금(acml_tr_pbmn) 파싱
  - 선물/옵션 모두 동일 API 구조로 처리
  - 26개 옵션 코드 자동 생성 (570-600 범위)

### 2025-12-23
- [x] 하드코딩된 종목코드 완전 제거 (SymbolMasterService)
- [x] Configuration 외부화 (application.properties)
- [x] KOSPI200 현재가 실시간 조회 구현
- [x] 캐싱 시스템 구현 (Spring Cache)
- [x] 선물 거래대금 버그 수정 (억원 단위)
- [x] 옵션 실시간 구독 에러 방지 (주간장 비활성화)

### 2025-12-22
- [x] 거래량, 거래대금, 미결제 데이터 흐름 분석
- [x] API 필드 매핑 검증 (선물/옵션)
- [x] 단위 변환 로직 확인 (천원→억원)

### 2025-12-21
- [x] Linux 배포 환경 수정 (mvnw.sh 복구)
- [x] 투자자 안내문 기능 추가
- [x] 시장 상태 표시 개선
- [x] 프로젝트 구조 정리 (docs/ 폴더)

---

## 🎉 다음 마일스톤

### v1.1 (목표: 2025년 1월)
- [ ] 사이드바 메뉴 버그 수정 🔥
- [ ] 토큰 관리 통합
- [ ] Rate Limiting 처리
- [ ] 야간장 대응
- [x] ~~휴장일 처리 시스템~~ ✅ (12/25 완료)
- [x] ~~전거래일 데이터 로드~~ ✅ (12/25 완료)

### v1.5 (목표: 2025년 2월 - 시각화 특별판) ⭐
- [ ] **마켓 뎁스 차트** (업비트 스타일)
- [ ] **옵션 히트맵** (Strike × Expiry)
- [ ] 옵션 전략 시뮬레이터 (기본 4가지)
- [ ] IV Rank/Percentile 추적

### v2.0 (목표: 2025년 3월 - 고급 분석)
- [ ] Volatility Surface 3D
- [ ] 포지션 트래커 (내 계좌)
- [ ] 실시간 뉴스 피드
- [ ] 경제 지표 캘린더
- [ ] 스크리너 기능

### v2.5 (목표: 2025년 4월 - 프레임워크 전환)
- [ ] React 프론트엔드 분리
- [ ] Spring Boot 3.x 유지 (현재 3.4.1)
- [ ] 멀티 계좌 지원
- [ ] 백테스팅 엔진
- [ ] 알림 시스템 (Alert)

---

## 📈 2025-12-26 (목요일) 예정 작업

### 최우선: 거래일 데이터 검증 ⭐⭐⭐
- [ ] **오전 9시 이전**:
  - 애플리케이션 시작 로그 확인
  - "오늘은 정상 거래일입니다" 메시지 확인
  - 실시간 데이터 WebSocket 연결 상태 체크

- [ ] **장중 (9:00-15:30)**:
  - 대시보드에 "주간장 거래중" 표시 확인
  - 선물/옵션 데이터 실시간 업데이트 모니터링
  - 미결제약정 변화 추적
  - 메모리/CPU 사용량 체크

- [ ] **장 마감 후 (15:30 이후)**:
  - 하루 거래 요약 데이터 검증
  - 로그 파일 점검
  - 에러 발생 여부 확인
  - 캡처 데이터 저장 확인 (capture/data/ 폴더)

### 긴급: 사이드바 메뉴 버그 수정 🐛
- [ ] **문제 상황**: 
  - 선물/옵션/Greeks 메뉴 클릭 후 대시보드로 돌아오면 이상한 페이지 표시
  - 사용자 제보: "다른 버튼을 클릭하고 다시 대시보드 버튼 클릭하면 다른 페이지가 나타남"
  
- [ ] **수정 작업**:
  - `dashboard.js` lines 1100-1140의 `showOverviewView` 함수 개선
  - 동적 컨텐츠 제거 로직 강화
  - 각 뷰 전환 시 상태 초기화 확실히 하기
  - 테스트: 모든 메뉴 순회 후 대시보드 복귀 확인

### 코드 정리 (선택 사항)
- [ ] KisApiService.java 주석 추가 (JavaDoc)
- [ ] 테스트 코드 작성 시작 (TradingCalendarService 우선)
- [ ] README.md 업데이트 (휴장일 기능 설명 추가)

---

**끝!** 천천히 하나씩 체크하면서 진행하세요! 화이팅! 🚀
